"use strict";var woostifyPrevSiblings=function(target){var siblings=[],n=target;if(n&&n.previousElementSibling)for(;n=n.previousElementSibling;)siblings.push(n);return siblings},woostifyNextSiblings=function(target){var siblings=[],n=target;if(n&&n.nextElementSibling)for(;n=n.nextElementSibling;)siblings.push(n);return siblings},woostifySiblings=function(target){var prev=woostifyPrevSiblings(target)||[],next=woostifyNextSiblings(target)||[];return prev.concat(next)},woostifyButtonShowPopup=function(){var buttons=document.querySelectorAll(".menu-item-mega_menu.menu-item-depth-0");buttons.length&&buttons.forEach((function(button){var buttonId=button.getAttribute("id"),input=button.querySelector(".edit-menu-item-title"),wrapper=!!input&&input.closest("p.description");wrapper&&buttonId&&(buttonId=buttonId.replace("menu-item-",""),wrapper.insertAdjacentHTML("afterend",'<div class="description description-wide"><span class="woostify-mega-menu-options-button button" data-id="'+buttonId+'" data-depth="0">'+woostify_admin_mega_menu.button_label+"</span></div>"))}))},woostifyIconPicker=function(){var picker=document.querySelector(".woostify-icon-picker");if(picker){var inner=picker.querySelector(".woostify-icon-picker-inner"),icons=picker.querySelectorAll("span"),input=picker.querySelector(".woostify-icon-picker-value");icons.length&&icons.forEach((function(element){element.onclick=function(){var sibs=woostifySiblings(element),attr=element.getAttribute("data-icon");element.classList.contains("selected")?(element.classList.remove("selected"),input.value=""):(element.classList.add("selected"),input.value=attr),sibs&&sibs.forEach((function(el){el.classList.remove("selected")}))}}))}},woostifySaveMenuOptions=function(){var popup=document.querySelector(".woostify-mega-menu-options-popup"),popupId=popup.getAttribute("data-id"),attr,_id=document.querySelector("#menu-item-"+popupId+" .woostify-mega-menu-options-button").getAttribute("data-id"),button;popup.querySelector(".save-options").onclick=function(){var t=this,menuItem=popup.querySelectorAll("[name*=woostify_mega_menu_item_]"),value={};t.classList.add("loading"),t.setAttribute("disabled","disabled"),menuItem.length&&menuItem.forEach((function(el){value[el.name]=el.value.replace(/&/g,encodeURIComponent("&"))}));var request=new Request(ajaxurl,{method:"POST",body:"action=woostify_save_menu_options&security_nonce="+woostify_admin_mega_menu.ajax_nonce+"&menu_item_id="+_id+"&options="+JSON.stringify(value),credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(request).then((function(res){200===res.status||console.log("Status Code: "+res.status)})).catch((function(err){console.log(err)})).finally((function(){t.classList.remove("loading"),t.removeAttribute("disabled")}))}},woostifyEditMegaMenu=function(){var button=document.querySelectorAll(".woostify-mega-menu-options-button");button.length&&button.forEach((function(element){var popup=document.querySelector(".woostify-mega-menu-options-popup"),inner=popup.querySelector(".woostify-mega-menu-popup-inner"),content=popup.querySelector(".woostify-mega-menu-popup-content"),label=popup.querySelector(".woostify-mega-menu-editing-label"),close=popup.querySelector(".woostify-mega-menu-popup-button-close"),_id=element.getAttribute("data-id"),_depth=element.getAttribute("data-depth"),hide=function(){document.documentElement.classList.remove("has-mega-menu-open")};element.onclick=function(){if(!(_depth>0)){document.documentElement.classList.add("has-mega-menu-open");var parent=document.getElementById("menu-item-"+_id),popupId=popup.getAttribute("data-id"),itemTitle=parent?parent.querySelector(".menu-item-title").innerHTML:"",itemType=parent?parent.querySelector(".item-type").innerHTML:"";if(popupId!==_id){label.innerHTML=label.getAttribute("data-label")+" "+itemType+": "+itemTitle,content.innerHTML="",inner.classList.add("loading");var request=new Request(ajaxurl,{method:"POST",body:"action=woostify_render_popup&security_nonce="+woostify_admin_mega_menu.ajax_nonce+"&menu_item_id="+_id+"&depth="+_depth,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(request).then((function(res){200===res.status?res.json().then((function(data){data.success&&(content.innerHTML=data.data,woostifyIconPicker())})):console.log("Status Code: "+res.status)})).catch((function(err){console.log(err)})).finally((function(){popup.setAttribute("data-id",_id),inner.classList.remove("loading"),woostifySaveMenuOptions(),popup.onclick=function(e){var _child;e.target.closest(".woostify-mega-menu-popup-inner")||hide()},close.onclick=function(){hide()},document.body.addEventListener("keyup",(function(e){27===e.keyCode&&hide()}))}))}}}}))};document.addEventListener("DOMContentLoaded",(function(){woostifyButtonShowPopup(),woostifyEditMegaMenu()}));