"use strict";const woostifyRangeValue=function(){let list=document.querySelector(".w-filter-check-range");if(!list)return;const removeItem=function(){let item=list.querySelectorAll(".w-filter-item-pack");item.length&&item.forEach((function(i){let removeButton=i.querySelector(".w-filter-range-item-remove");removeButton&&(removeButton.onclick=function(){i.remove()})}))},addItem=function(){let itemWrap=list.querySelector(".w-filter-container-inner"),addButton=list.querySelector(".w-filter-range-item-add");itemWrap&&addButton&&(addButton.onclick=function(){itemWrap.insertAdjacentHTML("beforeend",woostify_product_filter.item_node),removeItem()})};removeItem(),addItem()},woostifyUpdateAttr=function(){let type=document.querySelector('[name="woostify_product_filter_type"]');if(!type)return;let table=type.closest(".admin-product-filter");type.addEventListener("change",(function(){let source=document.querySelector('[name="woostify_product_filter_data"]'),required=document.querySelectorAll(".w-filter-check-range .w-filter-required");if(table.setAttribute("data-type",type.value),required.length&&("check-range"===type.value?required.forEach((function(ele){ele.setAttribute("required","required")})):required.forEach((function(ele){ele.removeAttribute("required"),ele.value.trim()||ele.closest(".w-filter-range-item").remove()}))),"visual"===type.value&&source){source.classList.add("product-attr-only");let isProductAttr=source.querySelector("[value="+source.value+"]");isProductAttr&&isProductAttr.classList.contains("product-taxonomy")&&(source.value="")}else"stock"===type.value&&source?(source.classList.add("stock"),source.classList.remove("product-attr-only")):(source.classList.remove("product-attr-only"),source.classList.remove("stock"))}))},woostifyToggleCheckboxValue=function(){let checkbox=document.querySelectorAll('.woostify-filter-item [type="checkbox"]');checkbox.length&&checkbox.forEach((function(el){let func=function(){let name=el.name,val,con=name+":"+el.value,req=document.querySelectorAll("[data-require]");if(req.length)for(let i=0,j=req.length;i<j;i++){let reqe=req[i].getAttribute("data-require");reqe.includes(name)&&(reqe===con?req[i].classList.remove("hidden"):req[i].classList.add("hidden"))}};func(),el.addEventListener("change",(function(){el.value="1"==el.value?"0":"1",func()}))}))},woostifyProductCatData=function(){let filter=document.querySelector('[name="woostify_product_filter_data"]'),data=document.querySelector(".w-filter-hierarchical-data");if(!filter||!data)return;const init=function(){"product_cat"==filter.value?data.classList.remove("hidden"):data.classList.add("hidden")};init(),filter.onchange=init;let includeChild=data.querySelector("#w-filter-source-term-hierarchical"),expandChild=data.querySelector("#w-filter-source-term-hierarchical-expand"),softLimit=document.querySelector(".soft-limit");includeChild&&expandChild&&includeChild.addEventListener("change",(function(){let expandParent=expandChild.closest(".w-filter-field");"0"==includeChild.value?(expandParent.classList.add("hidden"),softLimit&&softLimit.classList.remove("soft-limit-hidden")):(expandParent.classList.remove("hidden"),softLimit&&softLimit.classList.add("soft-limit-hidden"))}))},woostifyProductStock=function(){let filter=document.querySelector('[name="woostify_product_filter_type"]'),data=document.querySelector('[name="woostify_product_filter_data"]');if(!filter||!data)return;const init=function(){"checkbox"==filter.value?data.classList.remove("hidden"):data.classList.add("hidden")};init(),filter.onchange=init},woostifyProductStockType=function(){let filter=document.querySelector('[name="woostify_product_filter_type"]'),data=document.querySelector(".w-filter-stock-data"),stock=document.querySelector(".soft-limit");if(!filter||!data)return;const init=function(){"stock"==filter.value?(data.classList.remove("hidden"),stock.classList.add("hidden")):(data.classList.add("hidden"),stock.classList.remove("hidden"))};init(),filter.onchange=init},woostifyTermConditionData=function(){let condition=document.querySelector(".w-filter-condition-data"),select=!!condition&&condition.querySelector(".w-filter-condition-select"),field=!!condition&&condition.querySelector(".w-filter-condition-field");if(!select||!field)return;const init=function(){select.value?field.classList.remove("hidden"):field.classList.add("hidden")};init(),condition.onchange=init},woostifyFieldShowOn=function(selector){let fields=document.querySelectorAll(selector),type=document.querySelector('[name="woostify_product_filter_type"]');fields.length&&"stock"!=type.value&&fields.forEach((function(el){let showon,showon_args=el.getAttribute("showon").split(":"),showon_field_name=showon_args[0],is_equal=!0;void 0!==showon_args[0].split("!")[1]&&(is_equal=!1),is_equal||(showon_field_name=showon_args[0].split("!")[0]);let showon_field_val=showon_args[1],parent_field=document.getElementsByName(showon_field_name)[0],parent_field_val=parent_field.value;return is_equal?(parent_field_val===showon_field_val?el.classList.remove("hidden"):el.classList.add("hidden"),parent_field.addEventListener("change",(function(e){let curr_val;e.target.value===showon_field_val?el.classList.add("hidden"):el.classList.remove("hidden")})),!1):(parent_field_val!==showon_field_val?el.classList.remove("hidden"):el.classList.add("hidden"),parent_field.addEventListener("change",(function(e){let curr_val;e.target.value===showon_field_val?el.classList.add("hidden"):el.classList.remove("hidden")})),!1)}))},woostifySortableOrder=function(){let selector=document.querySelector(".woostify-multi-selection-inner"),parent=!!selector&&selector.closest(".woostify-multi-selection"),input=!!parent&&parent.querySelector(".woostify-multi-select-value");if(!selector)return;let sortable=new Sortable(selector);document.addEventListener("filterOrder",(function(){let data=[],list;selector.querySelectorAll(".woostify-multi-select-id").forEach((function(ele){let saveId=ele.getAttribute("data-id");saveId&&!data.includes(saveId)&&data.push(saveId)})),input.value=data.join("|")}))},woostifyIndexDatabase=function(){let indexBtn=document.querySelector(".filter-index-button");indexBtn&&(indexBtn.onclick=function(){let table=indexBtn.closest(".form-table"),lastIndex=!!table&&table.querySelector(".last-index"),indexCount=!!table&&table.querySelector(".index-count");if(!lastIndex||!indexCount||indexBtn.getAttribute("disabled")||indexBtn.parentNode.classList.contains("loading"))return;indexBtn.parentNode.classList.add("loading"),indexBtn.setAttribute("disabled","disabled"),indexBtn.innerHTML=woostify_product_filter.indexing_text+"...";let data={action:"woostify_index_filter",ajax_nonce:woostify_product_filter.ajax_nonce};data=new URLSearchParams(data).toString();let request=new Request(ajaxurl,{method:"POST",body:data,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(request).then((function(res){if(200!==res.status)throw console.log("Status Code: "+res.status),res;return res.json()})).then((function(json){if(!json.success)return;let data=json.data;indexBtn.innerHTML=woostify_product_filter.indexed_text,indexBtn.insertAdjacentHTML("afterend",'<span class="info-seuccess">'+woostify_product_filter.indexed_success+"</span>"),indexBtn.parentNode.classList.remove("loading");let indexNotice=document.querySelector(".woostify-filter-index-notice");indexNotice&&indexNotice.remove(),data.time&&(lastIndex.innerHTML=data.time),data.total&&(indexCount.innerHTML=data.total)})).catch((function(){indexBtn.parentNode.classList.remove("loading"),indexBtn.removeAttribute("disabled"),indexBtn.innerHTML="Re-index"}))})},woostifySortableFilter=function(){let list=jQuery("table.wp-list-table #the-list");list.sortable({items:"tr",axis:"y",update:function(){let data,ids=list.sortable("serialize");if(ids=ids.replaceAll("&post[]=",","),ids=ids.replace("post[]=",""),!ids.includes(","))return;data={action:"woostify_filter_list_sortable",post_ids:ids,ajax_nonce:woostify_product_filter.ajax_sortable_nonce},data=new URLSearchParams(data).toString();let request=new Request(ajaxurl,{method:"POST",body:data,credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"})});fetch(request)}})},woostifySelectText=function(){let shortcode=document.querySelectorAll(".w-filter-shortcode");shortcode.length&&window.getSelection&&shortcode.forEach((function(el){el.onclick=function(){let range=document.createRange();range.selectNode(el),window.getSelection().removeAllRanges(),window.getSelection().addRange(range)}}))};document.addEventListener("DOMContentLoaded",(function(){woostifyToggleCheckboxValue(),woostifyRangeValue(),woostifyUpdateAttr(),woostifyProductCatData(),woostifyTermConditionData(),woostifySortableOrder(),woostifyIndexDatabase(),woostifyFieldShowOn(".woostify-smart-product-filter-product-setting tr[showon]"),woostifyFieldShowOn(".admin-product-filter tr[showon]"),woostifySortableFilter(),woostifySelectText(),woostifyProductStockType()}));